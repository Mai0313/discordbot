# Discord Bot Project Context

## Project Overview

This project is an AI-powered Discord Bot built with **nextcord** (a fork of discord.py). It features multi-modal AI interactions (OpenAI, Claude), video downloading capabilities, a MapleStory database search, and a comprehensive auction system.

**Tech Stack:**

- **Language:** Python 3.11+
- **Framework:** `nextcord`
- **Dependency Manager:** `uv`
- **Linting/Formatting:** `ruff`
- **Type Checking:** `mypy`
- **Testing:** `pytest`
- **Containerization:** Docker & Docker Compose

## Architecture & Key Files

The project follows a modular "Cog" based architecture.

- **Entry Point:** `src/discordbot/cli.py` - Main bot class (`DiscordBot`) and startup logic.
- **Cogs (`src/discordbot/cogs/`):**
    - `gen_reply.py`: AI text generation (`/oai`).
    - `video.py`: Video downloader (`/download_video`).
    - `maplestory.py`: MapleStory DB search.
    - `auction.py`: Auction system (refactored into `_auction` submodule).
    - `summary.py`: Message summarization (`/sum`).
- **SDK (`src/discordbot/sdk/`):**
    - `llm.py`: Logic for interacting with LLMs (OpenAI/Azure).
    - `log_message.py`: Message logging to SQLite.
- **Data (`data/`):** Stores persistent data like `monsters.json` and `auctions.db`.
- **Configuration:**
    - `pyproject.toml`: Dependencies and tool configs (Ruff, Pytest, Mypy).
    - `.env`: Environment variables (API keys, tokens).

## Development Workflow

### Setup

The project uses `uv` for fast dependency management.

```bash
# Install dependencies
uv sync
```

### Running the Bot

```bash
# Run via entry point
uv run discordbot

# Or via python module
uv run python -m discordbot.cli
```

### Testing

```bash
# Run all tests
make test
# OR
uv run pytest
```

### Code Quality

The project enforces strict code quality standards.

```bash
# Run formatters and linters (Pre-commit)
make format
```

- **Style:** Google-style docstrings, strict typing.
- **Commits:** Follow **Conventional Commits** (e.g., `feat: add new command`, `fix: resolve crash`).

## Key Commands (Makefile)

- `make help`: Show help.
- `make clean`: Clean autogenerated files.
- `make uv-install`: Install uv.
- `make format`: Run pre-commit hooks.
- `make test`: Run tests.
- `make gen-docs`: Generate documentation.

## Notes for AI Agent

- **Language:** Interact with the user in **Traditional Chinese**. Write code, comments, and commit messages in **English**.
- **Changes:** Always check `pyproject.toml` for dependencies and configuration before modifying code.
- **Safety:** Explain any file system modifications or shell commands before execution.
